server {
    listen 80;
    server_name _;
    
    root /usr/share/nginx/html;
    index index.html;

    # Remove any potential redirect loops
    location / {
        try_files $uri $uri/ /index.html;
        
        # Required for Godot WebAssembly
        types {
            application/wasm wasm;
            application/javascript js;
            text/html html;
        }
        
        # Proper MIME types for Godot files
        location ~ \.(pck|wasm)$ {
            add_header Content-Type application/octet-stream;
            add_header Content-Disposition attachment;
        }
        
        add_header Cross-Origin-Opener-Policy same-origin;
        add_header Cross-Origin-Embedder-Policy require-corp;
    }

    # Prevent caching for index.html
    location = /index.html {
        add_header Cache-Control "no-store, no-cache, must-revalidate";
    }
}